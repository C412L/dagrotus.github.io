Vue.component("spritePalette",{template:"#sprite-palette-template",props:["sprites","clickfn"],data:function(){return{}},computed:{spriteRows:function(){let t=[],e=[];for(let i=0;i<this.sprites.length;i++)i>0&&i%6==0&&(e.push(t),t=[]),t.push(this.sprites[i]);return t.length>0&&e.push(t),e}}});let colorPickerComponent=VueColor.Sketch,chromePickerComponent=VueColor.Chrome;new Vue({el:"#app",data:{sprites:sprites,input:"",preview:"",previewFull:"",color:{hex:"#FF0000",rgba:{r:255,g:0,b:0,a:1},a:1},swatches:["#F00","#F90","#FF0","#0F0","#00F","#800080","#FFF","#000","#9EF","#A20","#FFE","#FBF","#2B9","#FD7","#840","#76D"],menuStates:{none:0,dropdownSprites:1,modalSprites:2,dropdownColors:3,modalColors:4,modalHelp:5,dropdownGradient:6,modalGradient:7},menuState:0,gradientStart:{hex:"#FF0000",rgba:{r:255,g:0,b:0,a:1},a:1},gradientEnd:{hex:"#0000FF",rgba:{r:0,g:0,b:255,a:1},a:1}},components:{"sketch-picker":colorPickerComponent,"chrome-picker":chromePickerComponent},methods:{clickSprite:function(t){let e=document.getElementById("input-text-area"),i=e.selectionStart,n="";n=""!==t.id?`<sprite=${t.id}>`:`<sprite name=${t.name}>`,this.input=this.input.slice(0,i)+n+this.input.slice(i),setTimeout(function(){e.selectionEnd=i+n.length},0)},clickApplyTypographyStyle:function(t){let e=document.getElementById("input-text-area"),i=`<${t}>`,n=e.selectionStart,s=e.selectionEnd;if(n===s)this.input=this.input.slice(0,n)+i+this.input.slice(n),setTimeout(function(){e.selectionStart=n+i.length,e.selectionEnd=n+i.length},0);else{this.input=this.input.slice(0,n)+i+this.input.slice(n);let l=`</${t}>`;this.input=this.input.slice(0,s+i.length)+l+this.input.slice(s+i.length),setTimeout(function(){e.selectionStart=n+i.length,e.selectionEnd=s+i.length},0)}},clickAddColor:function(t){let e=this.color,i=Math.round(255*e.a).toString(16);1===i.length&&(i="0"+i);let n="";t?(n=`#${Math.round(e.rgba.r/17).toString(16)}${Math.round(e.rgba.g/17).toString(16)}${Math.round(e.rgba.b/17).toString(16)}`,1!==e.a&&(n+=Math.round(("0x"+i)/17).toString(16))):(n=e.hex,1!==e.a&&(n+=i));let s=`<${n}>`,l=document.getElementById("input-text-area"),r=l.selectionStart,o=l.selectionEnd;if(r===o)this.input=this.input.slice(0,r)+s+this.input.slice(r),setTimeout(function(){l.selectionStart=r+s.length,l.selectionEnd=r+s.length},0);else{this.input=this.input.slice(0,r)+s+this.input.slice(r);let t="</color>";this.input=this.input.slice(0,o+s.length)+t+this.input.slice(o+s.length),setTimeout(function(){l.selectionStart=r+s.length,l.selectionEnd=o+s.length},0)}},clickAddGradient:function(){let t=document.getElementById("input-text-area"),e=t.selectionStart,i=t.selectionEnd,n=this.input.slice(e,i);e===i&&(e=0,i=(n=this.input).length);let s=this.removeTags(n),l=s.text.replace(/ /g,"");if(l.length<2)return;let r=[this.gradientStart.rgba.r,this.gradientStart.rgba.g,this.gradientStart.rgba.b],o=[this.gradientEnd.rgba.r,this.gradientEnd.rgba.g,this.gradientEnd.rgba.b],a=[];for(let t=0;t<l.length;t++){let e=[];for(let i=0;i<3;i++)e[i]=Math.round(r[i]+t/(l.length-1)*(o[i]-r[i]));a.push(`<${this.rgbToShortHex(e)}>`)}a=a.slice().reverse();let p=s.slices,c="";for(let t=0;t<n.length;t++){let e=!0;if(" "!==n[t]){for(let i=0;i<p.length;i++)if(t>=p[i][0]&&t<p[i][1]){c+=a.pop()+n[t],e=!1;break}e&&(c+=n[t])}else c+=n[t]}this.input=this.input.slice(0,e)+c+this.input.slice(i)},removeTags:function(t){let e=!1,i="",n=[],s=0,l=0,r="";for(let r=0;r<t.length;r++)"<"===t[r]?(e=!0,i+=t[r],l=r):">"===t[r]&&e?(i+=t[r],e=!1,"plain"!==this.checkTag(i).type&&(n.push([s,l]),s=r+1),i=""):e&&(i+=t[r]);for(slice of(n.push([s,t.length]),n))r+=t.slice(slice[0],slice[1]);return{text:r,slices:n}},rgbToShortHex:function(t){if(!t.push&&0!==t.length)return;let e="#";for(let i=0;i<t.length;i++){e+=Math.round(Number(t[i])/17).toString(16)}return e},checkTag:function(t){if(/<sprite(=\d+)?( name="?[a-zA-Z]+"?)?>/.test(t)){let e,i=t.indexOf("name=");if(-1===i){let i=t.substr(8).replace(">","");""!==i&&(e=this.sprites.find(t=>t.id==i))}else{let n=t.slice(i+5).replace(">","").replace(/"/g,"");e=this.sprites.find(t=>t.name===n)}return void 0===e?{type:"plain",html:t}:{type:"sprite",html:e.image}}if(/<(b|i|u|s|mark|sub|sup)( (?! )\S*)*>/.test(t))return{type:"style",html:/sub|sup|b|i|u|s|mark/.exec(t)[0]};if(/<\/(b|i|u|s|mark|sub|sup|a|color)( (?! )\S*)*>/.test(t))return{type:"closing",html:/sub|sup|b|i|u|s|mark|color/.exec(t)[0]};if(/<#.+>/.test(t)||/<color="#.+">/.test(t)){let e=t.match(/[\dA-Za-z]+/)[0];if(3===e.length||4===e.length||6===e.length||8===e.length){let t="#";for(let i=0;i<e.length;i++)/[^\dA-Fa-f]/.test(e[i])?t+="F":t+=e[i];return{type:"color",html:"color",color:t}}return{type:"plain",html:t}}return/<color="?red|orange|black|white|green|yellow|purple|blue"?>/.test(t)?{type:"color",html:"color",color:/red|orange|black|white|green|yellow|purple|blue/.exec(t)[0]}:{type:"plain",html:t}},plainTextTagTemplate:function(t,e){if(t=t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),e){let i=e.slice().reverse();for(style of i)t="color"===style.type?`<em style="color: ${style.color}">${t}</em>`:`<${style.html}>${t}</${style.html}>`}return`<div>${t}</div>`},spriteImageTagTemplate:function(t,e){let i="",n=!1;if(e){let t=e;for(style of t)style.type;t.some(t=>"u"===t.html)&&(i+='<div class="sprite-style-underlined">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div>'),t.some(t=>"s"===t.html)&&(i+='<div class="sprite-style-strike">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div>'),n=t.some(t=>"mark"===t.html)}return`<div class="sprite-preview-wrapper d-flex ${n?"sprite-preview-mark":""}" style="">${i}${`<img class="sprite-preview" src="${t}" style="" width="50" height="50">`}</div>`},parseInput:function(t){let e="",i=!1,n="",s="",l=[];for(let r=0;r<t.length;r++)if("<"===t[r])i?(e+=this.plainTextTagTemplate(n,l),n=""):""!==s&&(e+=this.plainTextTagTemplate(s,l),s=""),i=!0,n+=t[r];else if(">"===t[r])if(i){n+=t[r];let s=this.checkTag(n);if("plain"===s.type)e+=this.plainTextTagTemplate(s.html,l);else if("sprite"===s.type)e+=this.spriteImageTagTemplate(s.html,l);else if("color"===s.type)l.push(s);else if("closing"===s.type){let t=l.slice().reverse().findIndex(t=>t.html===s.html);if(-1!==t){let e=l.length-1-t;l.splice(e,1)}}else"style"===s.type&&l.push(s);n="",i=!1}else s+=t[r];else i?n+=t[r]:s+=t[r];return""!=s?e+=this.plainTextTagTemplate(s,l):""!=n&&(e+=this.plainTextTagTemplate(n,l)),`<div class="d-flex align-items-center">${e}</div>`},toggleMenu(t){this.menuState===t?this.menuState=this.menuStates.none:this.menuState=t},copyInput:function(){let t=document.getElementById("input-text-area"),e=t.selectionStart,i=t.selectionEnd;e!==i?t.setSelectionRange(e,i):t.setSelectionRange(0,this.input.length),t.focus(),document.execCommand("copy"),t.selectionStart=e,t.selectionEnd=i,document.getElementById("clipboard-confirm").classList.add("show"),setTimeout(function(){document.getElementById("clipboard-confirm").classList.remove("show")},2e3)},dismissConfirm:function(){document.getElementById("clipboard-confirm").classList.remove("show")}},computed:{showDropdownSprites:function(){return this.menuState===this.menuStates.dropdownSprites},showModalSprites:function(){return this.menuState===this.menuStates.modalSprites},showDropdownColors:function(){return this.menuState===this.menuStates.dropdownColors},showModalColors:function(){return this.menuState===this.menuStates.modalColors},showModalHelp:function(){return this.menuState===this.menuStates.modalHelp},showDropdownGradient:function(){return this.menuState===this.menuStates.dropdownGradient},showModalGradient:function(){return this.menuState===this.menuStates.modalGradient},spritesOrderByTitle:function(){return this.sprites.slice().sort((t,e)=>t.title>e.title?1:t.title<e.title?-1:0)}},watch:{input:function(){this.preview=this.parseInput(this.input.slice(0,50)),this.previewFull=this.parseInput(this.input)}},mounted:function(){let t=this;document.onkeyup=function(t){},document.onclick=function(e){e.target.matches(".skip-menu-state")||null!==e.target.closest(".menu-color-picker")||null!==e.target.closest(".gradient-color-pickers")||(t.menuState=t.menuStates.none)}}});