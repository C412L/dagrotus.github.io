Vue.component("spritePalette",{template:"#sprite-palette-template",props:["sprites","clickfn"],data:function(){return{}},computed:{spriteRows:function(){let t=6,e=[],i=[];for(let n=0;n<this.sprites.length;n++)n>0&&n%t==0&&(i.push(e),e=[]),e.push(this.sprites[n]);return e.length>0&&i.push(e),i}}});let colorPickerComponent=VueColor.Sketch,chromePickerComponent=VueColor.Chrome;new Vue({el:"#app",data:{sprites:sprites,input:"",preview:"",previewFull:"",color:{hex:"#FF0000",rgba:{r:255,g:0,b:0,a:1},a:1},swatches:["#F00","#F90","#FF0","#0F0","#00F","#800080","#FFF","#000","#9EF","#A20","#FFE","#FBF","#2B9","#FD7","#832","#76D"],regionSwatches:[{hex:"#99EEFF",rgba:{r:153,g:238,b:255,a:1},a:1},{hex:"#AA2200",rgba:{r:170,g:34,b:0,a:1},a:1},{hex:"#FFFFEE",rgba:{r:255,g:255,b:238,a:1},a:1},{hex:"#FFBBFF",rgba:{r:255,g:187,b:255,a:1},a:1},{hex:"#22BB99",rgba:{r:34,g:187,b:153,a:1},a:1},{hex:"#FFDD77",rgba:{r:255,g:221,b:119,a:1},a:1},{hex:"#883322",rgba:{r:136,g:51,b:34,a:1},a:1},{hex:"#7766DD",rgba:{r:119,g:102,b:221,a:1},a:1}],menuStates:{none:0,dropdownSprites:1,modalSprites:2,dropdownColors:3,modalColors:4,modalHelp:5,dropdownGradient:6,modalGradient:7},menuState:0,gradientStart:{hex:"#FF0000",rgba:{r:255,g:0,b:0,a:1},a:1},gradientEnd:{hex:"#0000FF",rgba:{r:0,g:0,b:255,a:1},a:1}},components:{"sketch-picker":colorPickerComponent,"chrome-picker":chromePickerComponent},methods:{clickSetSwatch:function(t,e){t?this.gradientStart=e:this.gradientEnd=e},clickSprite:function(t){let e=document.getElementById("input-text-area"),i=e.selectionStart,n="";n=""!==t.id?`<sprite=${t.id}>`:`<sprite name=${t.name}>`,this.input=this.input.slice(0,i)+n+this.input.slice(i),e.focus(),setTimeout(function(){e.selectionEnd=i+n.length},0)},clickApplyTypographyStyle:function(t){let e=document.getElementById("input-text-area"),i=`<${t}>`,n=e.selectionStart,s=e.selectionEnd;if(n===s)this.input=this.input.slice(0,n)+i+this.input.slice(n),e.focus(),setTimeout(function(){e.selectionStart=n+i.length,e.selectionEnd=n+i.length},0);else{this.input=this.input.slice(0,n)+i+this.input.slice(n);let r=`</${t}>`;this.input=this.input.slice(0,s+i.length)+r+this.input.slice(s+i.length),e.focus(),setTimeout(function(){e.selectionStart=n+i.length,e.selectionEnd=s+i.length},0)}},clickAddColor:function(t){let e=this.color,i=Math.round(255*e.a).toString(16);1===i.length&&(i="0"+i);let n="";t?(n=`#${Math.round(e.rgba.r/17).toString(16)}${Math.round(e.rgba.g/17).toString(16)}${Math.round(e.rgba.b/17).toString(16)}`,1!==e.a&&(n+=Math.round(("0x"+i)/17).toString(16))):(n=e.hex,1!==e.a&&(n+=i));let s=`<${n}>`,r=document.getElementById("input-text-area"),l=r.selectionStart,o=r.selectionEnd;l===o?(this.input=this.input.slice(0,l)+s+this.input.slice(l),r.focus(),setTimeout(function(){r.selectionStart=l+s.length,r.selectionEnd=l+s.length},0)):(this.input=this.input.slice(0,l)+s+this.input.slice(l),r.focus(),setTimeout(function(){r.selectionStart=l+s.length,r.selectionEnd=o+s.length},0))},clickAddGradient:function(){let t=document.getElementById("input-text-area"),e=t.selectionStart,i=t.selectionEnd,n=this.input.slice(e,i);e===i&&(n=this.input,e=0,i=n.length);let s=this.removeTags(n),r=s.text.replace(/ /g,"");if(r.length<2)return;let l=[this.gradientStart.rgba.r,this.gradientStart.rgba.g,this.gradientStart.rgba.b],o=[this.gradientEnd.rgba.r,this.gradientEnd.rgba.g,this.gradientEnd.rgba.b],a=[];for(let t=0;t<r.length;t++){let e=[];for(let i=0;i<3;i++)e[i]=Math.round(l[i]+t/(r.length-1)*(o[i]-l[i]));a.push(`<${this.rgbToShortHex(e)}>`)}a=a.slice().reverse();let c=s.slices,p="";for(let t=0;t<n.length;t++){let e=!0;if(" "!==n[t]){for(let i=0;i<c.length;i++)if(t>=c[i][0]&&t<c[i][1]){p+=a.pop()+n[t],e=!1;break}e&&(p+=n[t])}else p+=n[t]}this.input=this.input.slice(0,e)+p+this.input.slice(i),t.focus()},removeTags:function(t){let e=!1,i="",n=[],s=0,r=0,l="";for(let l=0;l<t.length;l++)"<"===t[l]?(e=!0,i+=t[l],r=l):">"===t[l]&&e?(i+=t[l],e=!1,"plain"!==this.checkTag(i).type&&(n.push([s,r]),s=l+1),i=""):e&&(i+=t[l]);n.push([s,t.length]);for(let e of n)l+=t.slice(e[0],e[1]);return{text:l,slices:n}},rgbToShortHex:function(t){if(!t.push&&0!==t.length)return;let e="#";for(let i=0;i<t.length;i++){let n=Math.round(Number(t[i])/17).toString(16);e+=n}return e},checkTag:function(t){if(/<sprite(=\d+)?( name="?[a-zA-Z]+"?)?>/.test(t)){let e,i=t.indexOf("name=");if(-1===i){let i=t.substr(8).replace(">","");""!==i&&(e=this.sprites.find(t=>t.id==i))}else{let n=t.slice(i+5).replace(">","").replace(/"/g,"");e=this.sprites.find(t=>t.name===n)}return void 0===e?{type:"plain",html:t}:{type:"sprite",html:e.image}}if(/<(b|i|u|s|mark|sub|sup)( (?! )\S*)*>/.test(t))return{type:"style",html:/sub|sup|b|i|u|s|mark/.exec(t)[0]};if(/<\/(b|i|u|s|mark|sub|sup|a|color)( (?! )\S*)*>/.test(t))return{type:"closing",html:/sub|sup|b|i|u|s|mark|color/.exec(t)[0]};if(/<#.+>/.test(t)||/<color="#.+">/.test(t)){let e=t.match(/[\dA-Za-z]+/)[0];if(3===e.length||4===e.length||6===e.length||8===e.length){let t="#";for(let i=0;i<e.length;i++)/[^\dA-Fa-f]/.test(e[i])?t+="F":t+=e[i];return{type:"color",html:"color",color:t}}return{type:"plain",html:t}}return/<color="?red|orange|black|white|green|yellow|purple|blue"?>/.test(t)?{type:"color",html:"color",color:/red|orange|black|white|green|yellow|purple|blue/.exec(t)[0]}:{type:"plain",html:t}},plainTextTagTemplate:function(t,e){if(t=t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),e){let i=e.slice().reverse();for(let e of i)t="color"===e.type?`<em style="color: ${e.color}">${t}</em>`:`<${e.html}>${t}</${e.html}>`}return`<div>${t}</div>`},spriteImageTagTemplate:function(t,e){let i="",n="",s=!1;if(e){let t=e;for(let e of t)e.type;t.some(t=>"u"===t.html)&&(n+='<div class="sprite-style-underlined">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div>'),t.some(t=>"s"===t.html)&&(n+='<div class="sprite-style-strike">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div>'),s=t.some(t=>"mark"===t.html)}let r="",l=`<img class="sprite-preview" src="${t}" style="${i}${r}" width="50" height="50">`;return`<div class="sprite-preview-wrapper d-flex ${s?"sprite-preview-mark":""}" style="${r}">${n}${l}</div>`},parseInput:function(t){let e="",i=!1,n="",s="",r=[];for(let l=0;l<t.length;l++)if("<"===t[l])i?(e+=this.plainTextTagTemplate(n,r),n=""):""!==s&&(e+=this.plainTextTagTemplate(s,r),s=""),i=!0,n+=t[l];else if(">"===t[l])if(i){n+=t[l];let s=this.checkTag(n);if("plain"===s.type)e+=this.plainTextTagTemplate(s.html,r);else if("sprite"===s.type)e+=this.spriteImageTagTemplate(s.html,r);else if("color"===s.type)r.push(s);else if("closing"===s.type){let t=r.slice().reverse(),e=t.findIndex(t=>t.html===s.html);if(-1!==e){let t=r.length-1-e;r.splice(t,1)}}else"style"===s.type&&r.push(s);n="",i=!1}else s+=t[l];else i?n+=t[l]:s+=t[l];return""!=s?e+=this.plainTextTagTemplate(s,r):""!=n&&(e+=this.plainTextTagTemplate(n,r)),`<div class="d-flex align-items-center">${e}</div>`},toggleMenu(t){this.menuState===t?this.menuState=this.menuStates.none:this.menuState=t},copyInput:function(){let t=document.getElementById("input-text-area"),e=t.selectionStart,i=t.selectionEnd;e!==i?t.setSelectionRange(e,i):t.setSelectionRange(0,this.input.length),t.focus(),document.execCommand("copy"),t.selectionStart=e,t.selectionEnd=i,document.getElementById("clipboard-confirm").classList.add("show"),setTimeout(function(){document.getElementById("clipboard-confirm").classList.remove("show")},2e3)},dismissConfirm:function(){document.getElementById("clipboard-confirm").classList.remove("show")}},computed:{showDropdownSprites:function(){return this.menuState===this.menuStates.dropdownSprites},showModalSprites:function(){return this.menuState===this.menuStates.modalSprites},showDropdownColors:function(){return this.menuState===this.menuStates.dropdownColors},showModalColors:function(){return this.menuState===this.menuStates.modalColors},showModalHelp:function(){return this.menuState===this.menuStates.modalHelp},showDropdownGradient:function(){return this.menuState===this.menuStates.dropdownGradient},showModalGradient:function(){return this.menuState===this.menuStates.modalGradient},spritesOrderByTitle:function(){return this.sprites.slice().sort((t,e)=>t.title>e.title?1:t.title<e.title?-1:0)}},watch:{input:function(){this.preview=this.parseInput(this.input.slice(0,50)),this.previewFull=this.parseInput(this.input)}},mounted:function(){let t=this;document.onkeyup=function(t){},document.onclick=function(e){e.target.matches(".skip-menu-state")||null!==e.target.closest(".menu-color-picker")||null!==e.target.closest(".gradient-color-pickers")||(t.menuState=t.menuStates.none)}}});